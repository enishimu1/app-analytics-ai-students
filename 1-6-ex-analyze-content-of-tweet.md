# 演習 - ツイートのコンテンツを分析する

**[Home](./README.md)**

この演習では、引き続きソーシャル メディア監視アプリで作業を行います。 自社の製品に関するツイートが肯定的なものか否定的なものかどうかについて分析します。 ツイートのセンチメントを表す数値の "スコア" を提供するセンチメントの検出アクションを作成します。 次の図は、作業を行う部分が強調表示された、アプリの概念図を示しています。

## Text Analytics キーとエンドポイントを取得する
Azure Text Analytics API は、テキストの自然言語処理を提供します。 感情分析、キーフレーズ抽出、言語検出、エンティティのリンクを行うことができます。 感情分析のためにこれを使用します。 Text Analytics リソースを作成し、キーとエンドポイント URL を返します。 これらの値は、この演習でセンチメント スコアを呼び出して取得するのに必要になります。

1. [Azure portal](https://portal.azure.com/) にサインインします。
1. Azure portal のメニューで [リソースの作成] を選択し、上部の検索ボックスで `テキスト分析` と入力します。 [テキスト分析] ペインが表示されます。
1. テキスト分析画面で[作成] ボタンをクリックします。
1. [追加機能の選択]画面はそのままにして[リソースの作成を続行する]ボタンをクリックします。 [言語の作成] ペインが表示されます。

## Azure テキスト分析のリソースを構成する
リソース グループや場所などの基本的な設定を構成しましょう。

1. [基本] タブで、各設定に対して次の値を入力します。

    |  設定  |  値  |
    | ---- | ---- |
    |  **プロジェクトの詳細**  ||
    |  サブスクリプション  |  ご自分のサブスクリプション  |
    |  リソース グループ   |  作成済みのリソース グループ(デフォルトは ShoeTracker_group)  |
    |  **インスタンスの詳細**  ||
    |  リージョン  |  最も近い場所をドロップダウン リストから選択します。  |
    |  名前  |  TweetTextAnalytics  |
    |  価格レベル  |  Free F0 (5K Transactions per 30 days)  |
    |  **責任ある AI 通知**  ||
    |  このボックスをオンにすることで、責任ある AI 通知の条項を承認し、同意したことを確認します。  |  チェックを入れます  |

1. [確認と作成]、[作成] の順に選択します。 [デプロイ] ペインに、作成されたリソースが表示されます。 デプロイが正常に終了するまで待ちます。
1. デプロイが完了したら、[リソースの移動]をクリックします。
1. 左のメニューから[キーとエンドポイント]をクリックします。
1. `キー` と `エンドポイント` をどこか安全な場所に保存します。 これらは、この演習でポータルでアプリを更新するときに必要です。

## センチメントの検出アクションを見つける
ここでは、Azure portal を使用して、センチメントの検出アクションを見つけます。

1. [ロジック アプリ デザイナー] を選択して、ロジック アプリ デザイナーに戻ります。 このボタンは、左側のメニュー ペインの [開発ツール] セクションの下にあります。
1. Twitter トリガーの下で、[新しいステップ] を選択します。
1. [コネクタとアクションを検索する] 検索ボックスに、 `センチメント` と入力します。
1. [**センチメント (V4)(プレビュー)**] コネクタを選択します。

## センチメントの検出アクションを作成する
センチメントの検出アクションが見つかったので、そのインスタンスを作成しましょう。 また、このプロセスでは、それを Text Analytics サブスクリプションに接続するように構成します。

1. [接続名] フィールドに、 `CognitiveServicesConnection` と入力します。
1. 保存した API キーを [アカウント キー] フィールドに、保存したエンドポイント アドレスを [サイトの URL] フィールドに貼り付けます。
1. ［作成］ を選択します

## センチメントの検出アクションを構成する
次に、ツイート テキストをセンチメントの検出アクションに渡すように、ロジック アプリを構成します。

1. [リソースのサブドメインや地域] ドロップダウンリストから、[Use connection settings(tweettextanalytics)] を選択します。
1. [documents id - 1] ボックスをクリックし、動的コンテンツのポップアップで、`ツイート ID` を選択します。
1. [documents text - 1] ボックスをクリックし、動的コンテンツのポップアップで、`ツイート テキスト` を選択します。
1. [documents language - 1] ボックスに `ja` と入力します。

    > **注意**
    > RSS [フィード項目が公開される場合] トリガーを使用している場合は、FeedSummary を Text Analytics サービスに送信します。
    
1. Logic Apps デザイナーで [保存] を選択します。

## センチメントの検出アクションの結果を確認する
これでアプリがライブになりました。 製品名を含むツイートが Text Analytics サービスによって処理され、文とドキュメントのレベルで返される感情ラベルとそれぞれの信頼度スコアがテキストに適用されます。新しいバージョンの感情分析では、自動的に positive、negative、および neutral のラベルに分類されます。さらに各ラベルについて信頼度スコアが 1 から 0 の範囲で割り当てられます。 スコアが 1 に近いほど、ラベルの分類の信頼度が高いことを示し、スコアが低いほど信頼度が低いことを示します。 各ドキュメントまたは各文で、ラベル (positive、negative、neutral) に関連付けられた予測スコアは合計で 1 になります。

このセクションでは、アプリの実行を監視し、各ステップを流れるデータを表示する方法を確認します。 このツールは、アプリが正常に動作していることを確認するのに役立つため、知っておくとよいでしょう。

1. 左側のメニュー ペインで、[概要] を選択します。
1. [実行の履歴] テーブルに新しい行項目が表示されるまで、1 分ごとに [更新] を選択します。
1. 行項目が表示されたら、その項目を選択します。
1. センチメントの検出アクションを選択します。
1. ツイートのテキストと Cognitive Services エンジンによってそれに与えられたスコアを見つけます。

----

**[Home](./README.md)** 